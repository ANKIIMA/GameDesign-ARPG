# 框架设计

虽然是初学但是想了想还是有必要写一套框架，那么使用最简单的MVC就行，主要以实现逻辑分离和自己的功能为主。现在开源的框架功能都比较完善，但不是那么容易上手使用，且诸多功能在本项目中是不必要的。

大体和MVC在web开发上一致，Model负责管理数据增删改查；View负责一切用户交互，包括UI，场景管理，相机管理，还有音效；Controller负责业务逻辑。有博客指出Controller完全处理逻辑是不对的，反而要放到Model中供Controller灵活调用以增加重用性，后面会结合实际内容有缩调整。

## Model具体实现

所以现在的工作是，用自己写的类作为Model存储各个游戏对象的属性，该类不会继承Monobehaviour，也就是说不能通过Model来直接修改对象需要通过Monobehaviour完成的逻辑例如对象Transform和动画的播放。目前想法是除自定数据外的内容也一并放在Controller中直接获取，Controller获取单例的Model类存取其它数据。

Model第一使用单例，第二使用封装的属性，第三使用委托属性更新。

单例的实现只需要在Model类内部声明一个私有静态实例，并添加get方法；每个属性的set方法设置一个委托，绑定的事件函数到View中定义，这样如果Controller要修改属性时可以在调用set方法的同时调用需要的事件函数方法。例如修改血量的时候要修改UI表现，那么此时Controller修改了血量的值就顺便修改了View的表现。

目前Model的作用为管理所有需要的数据，全部做成属性供外部访问。

## View具体实现

定义各个属性对应委托的事件函数，绑定UI和字段值；这些属性不仅影响UI，还可能会影响其它场景、相机等地方的表现。

View应该继承Monobehaviour以利用Unity方法实现上述功能。游戏对象不需要View层脚本，它应该被挂接到相关物体或者直接用脚本获取相关对象。

目前View的作用为管理UI表现，通过委托将UI的变化绑定到相关值的变化。

## Controller具体实现

实现游戏逻辑，调用Model的方法控制属性变化，继承Monobehaviour以利用Unity方法实现对游戏对象的修改和对组件的获取。

目前Controller的作用为管理输入、管理动画、管理逻辑。其中AnimatorInitalize对状态机进行赋值，不关心具体逻辑实现；properitesManagement对属性进行再赋值，不关心具体逻辑实现；Locomotion管理角色移动系统，关心业务逻辑，不关心状态机；PlayerAttack管理角色攻击系统，关心业务逻辑，不关心状态机。

也就是说目前Controller层将业务逻辑和各项属性(动画状态机的值和角色属性)的赋值分成了两部分，在Update中先调用属性赋值部分，然后调用业务逻辑部分。看来这样似乎不是太对，而且Locomotion中其实有一个地方处理了下状态机，后面要改成完全解耦，并先计算业务再赋值。

另外，如果将View视为所有用户交互相关的部分，其实属性赋值要放在View中处理。



# UML图

![image-20230710233434788](移动)

![image-20230710233547362](连招)

![image-20230710233801814](NPC交互)

![image-20230710233915765](属性)

